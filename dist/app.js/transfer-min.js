localStorage.getItem("token")||(window.location.href="../login/login.html"),primus=Primus.connect("http://localhost:3000",{reconnect:{max:1/0,min:500,retries:10}}),primus.on("data",e=>{"updated balance counter"===e.action&&updateBalance()});let transferBtn=document.querySelector("#transfer"),amountField=document.querySelector("#input__amount"),receiverField=document.querySelector("#input__receiver"),messageField=document.querySelector(".message__field"),balanceCounter=document.querySelector("#balance"),transferReason=document.querySelector("#transferReason"),freeComment=document.querySelector("#comment");transferBtn.addEventListener("click",e=>{let t=amountField.value,n=receiverField.value,o=transferReason.value,a=freeComment.value;isEmpty(t)||isEmpty(n)||isEmpty(o)?messageField.innerHTML="gelieve alle velden in te vullen":fetch("http://localhost:3000/api/v1/transfers",{method:"post",headers:{"content-type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({amount:t,receiver:n,reason:o,comment:a})}).then(e=>e.json()).then(e=>{console.log(e),messageField.innerHTML=e.message,primus.write({action:"updated balance counter",data:e})}).catch(e=>{console.log(e)})});let updateBalance=()=>{fetch("http://localhost:3000/api/v1/transfers/user",{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{balanceCounter.innerHTML=e.user.balance}).catch(e=>{console.log(e)})};function isEmpty(e){return null==e||0===e.length}updateBalance();let userList=[];function autocomplete(e,t){var n;function o(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),n>=e.length&&(n=0),n<0&&(n=e.length-1),e[n].classList.add("autocomplete-active")}function a(t){for(var n=document.getElementsByClassName("autocomplete-items"),o=0;o<n.length;o++)t!=n[o]&&t!=e&&n[o].parentNode.removeChild(n[o])}e.addEventListener("input",function(o){var r,l,i,s=this.value;if(a(),!s)return!1;for(n=-1,(r=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),r.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(r),i=0;i<t.length;i++)t[i].substr(0,s.length).toUpperCase()==s.toUpperCase()&&((l=document.createElement("DIV")).innerHTML="<strong>"+t[i].substr(0,s.length)+"</strong>",l.innerHTML+=t[i].substr(s.length),l.innerHTML+="<input type='hidden' value='"+t[i]+"'>",l.addEventListener("click",function(t){e.value=this.getElementsByTagName("input")[0].value,a()}),r.appendChild(l))}),e.addEventListener("keydown",function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(n++,o(t)):38==e.keyCode?(n--,o(t)):13==e.keyCode&&(e.preventDefault(),n>-1&&t&&t[n].click())}),document.addEventListener("click",function(e){a(e.target)})}fetch("http://localhost:3000/api/v1/transfers/allUsers",{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{e.users.forEach(e=>{userList.push(e.fullname)}),autocomplete(document.getElementById("input__receiver"),userList)}).catch(e=>{console.log(e)});