const base_url="https://imdcurrency.herokuapp.com";localStorage.getItem("token")||(window.location.href="../login/login.html"),primus=Primus.connect(base_url,{reconnect:{max:1/0,min:500,retries:10}}),primus.on("data",e=>{"updated balance counter"===e.action&&updateBalance()});let transferBtn=document.querySelector("#transfer"),amountField=document.querySelector("#input__amount"),receiverField=document.querySelector("#input__receiver"),messageField=document.querySelector(".message__field"),balanceCounter=document.querySelector("#balance"),transferReason=document.querySelector("#transferReason"),freeComment=document.querySelector("#comment");transferBtn.addEventListener("click",e=>{let t=amountField.value,n=parseFloat(t).toFixed(2),a=receiverField.value,o=transferReason.value,r=freeComment.value,l=t.split("."),i=n.split(".");isEmpty(t)||isEmpty(a)||isEmpty(o)?messageField.innerHTML="gelieve alle velden in te vullen":l[1].toString().length>i[1].toString().length?messageField.innerHTML="Je kan max 2 cijfers na de komma invullen":fetch("http://localhost:3000/api/v1/transfers",{method:"post",headers:{"content-type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({amount:t,receiver:a,reason:o,comment:r})}).then(e=>e.json()).then(e=>{messageField.innerHTML=e.message,primus.write({action:"updated balance counter",data:e})}).catch(e=>{console.log(e)})});let updateBalance=()=>{fetch(base_url+"/api/v1/transfers/user",{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{balanceCounter.innerHTML=e.user.balance}).catch(e=>{console.log(e)})};function isEmpty(e){return null==e||0===e.length}updateBalance();let userList=[];function autocomplete(e,t){var n;function a(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),n>=e.length&&(n=0),n<0&&(n=e.length-1),e[n].classList.add("autocomplete-active")}function o(t){for(var n=document.getElementsByClassName("autocomplete-items"),a=0;a<n.length;a++)t!=n[a]&&t!=e&&n[a].parentNode.removeChild(n[a])}e.addEventListener("input",function(a){var r,l,i,s=this.value;if(o(),!s)return!1;for(n=-1,(r=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),r.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(r),i=0;i<t.length;i++)t[i].substr(0,s.length).toUpperCase()==s.toUpperCase()&&((l=document.createElement("DIV")).innerHTML="<strong>"+t[i].substr(0,s.length)+"</strong>",l.innerHTML+=t[i].substr(s.length),l.innerHTML+="<input type='hidden' value='"+t[i]+"'>",l.addEventListener("click",function(t){e.value=this.getElementsByTagName("input")[0].value,o()}),r.appendChild(l))}),e.addEventListener("keydown",function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(n++,a(t)):38==e.keyCode?(n--,a(t)):13==e.keyCode&&(e.preventDefault(),n>-1&&t&&t[n].click())}),document.addEventListener("click",function(e){o(e.target)})}fetch(base_url+"/api/v1/transfers/allUsers",{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{e.users.forEach(e=>{userList.push(e.fullname)}),autocomplete(document.getElementById("input__receiver"),userList)}).catch(e=>{console.log(e)});